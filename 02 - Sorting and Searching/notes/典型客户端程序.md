# 典型客户端程序

## 一、核心主题

本节围绕**白名单过滤器（Whitelist Filter）** 这一典型客户端展开，核心目标是实现 “筛选符合白名单的输入内容” 功能，并通过 “顺序查找（Sequential Search）” 支撑该功能，同时分析查找实现的问题、优化方向及性能表现。



## 二、关键内容梳理

### 1. 核心场景与定义

- **黑白名单区分**：
  - 黑名单（Blacklist）：需拒绝服务的实体列表（如透支账户、垃圾邮件发送者）。
  - 白名单（Whitelist）：需允许服务的实体列表（如信誉良好的账户、亲友联系人）。
- **白名单过滤器功能**：读取白名单文件中的字符串列表，从标准输入（StdIn）读取待筛选字符串，仅将 “在白名单中存在” 的字符串输出到标准输出（StdOut）。
- **典型应用示例**：邮件垃圾过滤（仅放行白名单中的发件人邮件地址）。



### 2. 白名单过滤器客户端实现

#### （1）工作流程

1. 从命令行参数获取白名单文件路径，读取文件中所有字符串作为白名单。
2. 循环读取标准输入（StdIn）中的字符串（如待筛选的邮件地址）。
3. 通过 “查找函数” 判断当前字符串是否在白名单中，若存在则输出到标准输出（StdOut）。

#### （2）示例运行效果

- 白名单文件（white4.txt）内容：`alice@home bob@office carl@beach dave@boat`
- 测试输入文件（test.txt）内容：`bob@office carl@beach marvin@spam bob@office bob@office mallory@spam dave@boat eve@airport alice@home`
- 运行命令：`java WhiteFilter white4.txt < test.txt`
- 输出结果：`bob@office carl@beach bob@office bob@office dave@boat alice@home`（仅保留白名单中的地址）



### 3. 查找功能的实现与优化

#### （1）初始错误实现（Strawman Implementation）

- 问题：使用 `==` 比较字符串，实际比较的是字符串的**内存引用**，而非字符串内容，导致匹配逻辑错误。

- 错误代码逻辑：

  ```java
  public static int search(String key, String[] a) { 
      for (int i = 0; i < a.length; i++) 
          if (a[i] == key) return i; // 错误：比较引用而非内容
      return -1; 
  }
  ```

#### （2）改进后的顺序查找

- 优化：使用`String.compareTo(key) == 0`比较字符串内容，确保逻辑正确。
- 核心逻辑：遍历数组，逐一对比每个元素与目标字符串，找到则返回索引，未找到返回`-1`。

```java
public static int search(String key, String[] a) { 
    for (int i = 0; i < a.length; i++) 
        if (a[i].compareTo(key) == 0) return i; // 正确：比较字符串内容
    return -1; 
}
```



### 4. 测试与性能分析

#### （1）随机字符串生成器（Generator）

- 用途：生成指定数量、长度、字符集的随机字符串，用于模拟白名单数据和测试数据。
- 核心功能：支持自定义参数（N：字符串数量，L：每个字符串长度，alpha：字符集）。

#### （2）顺序查找测试客户端（TestSS）

- 用途：测试顺序查找的性能，计算 “在长度为 N 的白名单中执行 10N 次查找” 的耗时。
- 测试逻辑：
  1. 读取随机生成的白名单字符串数组。
  2. 循环 10N 次，每次从白名单中随机选一个字符串作为查找目标。
  3. 记录总耗时，验证顺序查找的时间复杂度。

#### （3）实证性能结果

- 时间复杂度：**O(N²)**（查找次数与白名单长度 N 正相关，单次查找平均遍历 N/2 个元素）。

- 性能表现（以小写字母字符串为例）：

  | 白名单长度 N | 耗时（秒） | 事务处理速度（次 / 秒） |
  | ------------ | ---------- | ----------------------- |
  | 10,000       | 3          | 3,333                   |
  | 20,000       | 9          | 2,222                   |
  | 40,000       | 35         | 1,143                   |
  | 80,000       | 149        | 536                     |

- 结论：N 翻倍时，耗时约翻 4 倍，顺序查找**不具备可扩展性**，无法应对大规模白名单场景。